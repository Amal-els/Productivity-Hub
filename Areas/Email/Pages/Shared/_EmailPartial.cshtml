@model MimeKit.MimeMessage

@{
    var fromAddress = Model.From.Mailboxes.FirstOrDefault();
    var fromName = fromAddress?.Name ?? fromAddress?.Address ?? "Unknown";
    var messageId = Model.MessageId ?? Guid.NewGuid().ToString();

    // Get a preview of the email
    string preview = Model.TextBody;
    if (string.IsNullOrEmpty(preview) && Model.HtmlBody != null)
    {
        // Strip HTML tags for preview
        preview = System.Text.RegularExpressions.Regex.Replace(Model.HtmlBody, "<.*?>", string.Empty);
    }
    if (preview != null && preview.Length > 50)
    {
        preview = preview.Substring(0, 50) + "...";
    }
}

<tr class="email-row">
    <td class="align-middle">
        <div class="d-flex align-items-center">
            <div class="me-2">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" 
                     style="width: 40px; height: 40px; font-weight: bold;">
                    @(fromName.Length > 0 ? fromName[0].ToString().ToUpper() : "?")
                </div>
            </div>
            <div>
                <strong>@fromName</strong>
                @if (fromAddress != null)
                {
                    <br />
                    <small class="text-muted">@fromAddress.Address</small>
                }
            </div>
        </div>
    </td>
    <td class="align-middle">
        <strong>@Model.Subject</strong>
        <br />
        <small class="text-muted">@preview</small>
    </td>
    <td class="align-middle">
        <small>@Model.Date.ToLocalTime().ToString("MMM dd, h:mm tt")</small>
    </td>
    <td class="align-middle">
        <div class="btn-group btn-group-sm" role="group">
            <form method="post" asp-page-handler="MarkAsRead" class="d-inline">
                <input type="hidden" name="messageId" value="@messageId" />
                <button type="submit" class="btn btn-outline-primary" title="Mark as read">
                    <i class="bi bi-envelope-open"></i>
                </button>
            </form>
            <form method="post" asp-page-handler="Delete" class="d-inline">
                <input type="hidden" name="messageId" value="@messageId" />
                <button type="submit" class="btn btn-outline-danger" 
                        onclick="return confirm('Delete this email?')" 
                        title="Delete">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </div>
    </td>
</tr>
